<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>统一身份认证-登陆</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="./js/layui/css/layui.css" />
    <link rel="stylesheet" href="./css/layui-blue.css" />
    <script type="text/javascript" src="./js/layui/layui.all.js" ></script>
    <script type="text/javascript" src="./js/common.js" ></script>

    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="main-body">
    <div class="login-main">
        <div class="login-top">
            <span>统一身份认证平台</span>
            <span class="bg1"></span>
            <span class="bg2"></span>
        </div>
        <form class="layui-form login-bottom" id="loginForm">
            <div class="center">
                <div class="item">
                    <span class="icon icon-2"></span>
                    <input type="text" name="username" lay-verify="required"  placeholder="请输入登录账号" maxlength="24"/>
                </div>

                <div class="item">
                    <span class="icon icon-3"></span>
                    <input type="password" name="password" lay-verify="required"  placeholder="请输入密码" maxlength="20">
                    <span class="bind-password icon icon-4"></span>
                </div>
            </div>
            <div class="layui-form-item" style="text-align:center; width:100%;height:100%;margin:0;">
                <button class="login-btn" lay-submit lay-filter="login">立即登录</button>
            </div>
        </form>
    </div>
</div>
<div class="footer">
    这里是版权信息，请自行替换
</div>
<script>
    console.log("lay-ui:", layui)
    // 获取URL中的查询字符串
    const urlParams = new URLSearchParams(window.location.search);
    // 通过参数名获取参数值
    const redirectUri = urlParams.get('redirect_uri');
    console.log('redirectUri: ' + redirectUri);
    layui.use(['form','jquery'], function () {
        var $ = layui.$, form = layui.form,  layer = layui.layer;

        // 登录过期的时候，跳出ifram框架
        if (top.location != self.location) top.location = self.location;

        $('.bind-password').on('click', function () {
            if ($(this).hasClass('icon-5')) {
                $(this).removeClass('icon-5');
                $("input[name='password']").attr('type', 'password');
            } else {
                $(this).addClass('icon-5');
                $("input[name='password']").attr('type', 'text');
            }
        });

        $('.icon-nocheck').on('click', function () {
            if ($(this).hasClass('icon-check')) {
                $(this).removeClass('icon-check');
            } else {
                $(this).addClass('icon-check');
            }
        });

        layui.form.on('submit(login)', function(data){
            $.ajax({
                url: '/auth/usernamePwd',
                type: 'GET',
                // dataType: 'json',
                data: {
                    username: data.field.username,
                    password: data.field.password
                },
                success: function(data) {
                    if(data.code === 200) {
                        layer.msg('登录成功',{time : 1000},function(){
                            console.log("登录成功", data)
                            // location.href='./index.html';
                            if(redirectUri) {
                                location.href = redirectUri;
                            } else {
                                location.href='./test/demo';
                            }

                        })
                    }
                    if(data.code === 6000) {
                        layer.msg(data.msg, {time : 1000})
                    }
                }
            })
            return false;
        });
    });
</script>
</body>
</html>
